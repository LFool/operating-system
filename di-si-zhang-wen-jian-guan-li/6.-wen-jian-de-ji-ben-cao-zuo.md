# 6. 文件的基本操作

## 1. 创建文件（create 系统调用）

进行 Create 系统调用时，需要提供几个**主要参数**：

1. 所需的外存空间大小（如：一个盘块，即 1KB）
2. 文件存放路径（“D:/demo”）
3. 文件名

操作系统在处理 Create 系统调用时，主要做了**两件事**：

1. **在外存中找到文件所需要的空间**（通过[空闲分区管理](5.-kong-xian-fen-qu-guan-li.md)中的方法找到空闲空间）
2. 根据文件存放路径找到该目录对应的目录文件，**在目录文件中创建该文件对应的目录项**，包括：文件名、文件的外存信息等

## 2. 删除文件（delete 系统调用）

进行 Delete 系统调用时，需要提供几个**主要参数**：

1. 文件存放路径（“D:/demo”）
2. 文件名（“test.txt”）

操作系统在处理 Create 系统调用时，主要做了**几件事**：

1. 根据文件存放路径找到该目录对应的目录文件，从**目录文件中找到该文件对应的目录项**
2. 根据该目录项中记录的文件在外存的存放位置、文件大小信息，**回收文件占用的磁盘块**（回收磁盘块，根据[空闲分区管理](5.-kong-xian-fen-qu-guan-li.md)中的方法回收空闲块）
3. 从目录表中**删除对应的目录项**

## 3. 读文件（read 系统调用）

进程使用 read 系统调用完成写操作。需要指明是哪个文件（在支持 “打开文件” 操作的系统中，只需要提供文件在打开文件表中的索引号即可），还需 要指明要读入多少数据（如：读入 1KB）、指明读入的数据要放在内存中的什么位置

操作系统在处理 read 系统调用时，会从读指针指向的外存中，将用户指定大小的数据读入用户指定的内存区域中

## 4. 写文件（write 系统调用）

进程使用 write 系统调用完成写操作，需要指明是哪个文件（在支持“打开文件”操作的系统中，只需 要提供文件在打开文件表中的索引号即可），还需 要指明要写出多少数据（如：写出 1KB）、写回外存的数据放在内存中的什么位置

操作系统在处理write 系统调用时，会从用户指定的内存区域中，将指定大小的数据写回写指针指向的外存

## 5. 打开文件（open 系统调用）

在对文件进行操作之前，要求用户先使用 open 系统调用 “打开文件”，需要提供的几个主要参数：

1. 文件存放路径（“D:/demo”）
2. 文件名（“test.txt”）
3. 要对文件的操作类型（如：r 只读；rw 读写等）

操作系统在处理 Create 系统调用时，主要做了**几件事**：

1. 根据文件存放路径找到相对应的目录文件，从目录中**找到文件名对应的目录项**，并检查该用户是否有指定的的操作权限
2. **将目录项复制到内存的 打开文件表 中**，并将对应表目的编号返回给用户，之后**用户使用打开文件表的编号来指明要操作的文件**

![](../.gitbook/assets/image%20%2889%29.png)

## 6. 关闭文件（close 系统调用）

进程使用完文件后，要 “关闭文件” 操作系统在处理 Close 系统调用时，主要做了几件事：

1. 将进程的打开文件表相应表项删除
2. 回收分配给该文件的内存空间等资源
3. 系统打开文件表的打开计数器 count 减 1，若 count = 0，则删除对应表项

